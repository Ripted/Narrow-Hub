<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Narrow Arrow Stats Hub</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        header { text-align: center; color: white; margin-bottom: 40px; }
        h1 { font-size: 3em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .subtitle { font-size: 1.2em; opacity: 0.9; }
        .tools-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .tool-card { background: white; border-radius: 15px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); transition: transform 0.3s ease; }
        .tool-card:hover { transform: translateY(-5px); }
        .tool-header { display: flex; align-items: center; margin-bottom: 15px; }
        .tool-icon { font-size: 2em; margin-right: 15px; }
        .tool-title { font-size: 1.5em; color: #333; }
        .tool-description { color: #666; margin-bottom: 20px; line-height: 1.5; }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: #555; font-weight: 500; }
        input, select { width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1em; transition: border-color 0.3s; }
        input:focus, select:focus { outline: none; border-color: #667eea; }
        button { width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer; transition: opacity 0.3s; }
        button:hover { opacity: 0.9; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .button-group { display: flex; gap: 10px; margin-bottom: 15px; }
        .button-group button { flex: 1; padding: 8px; font-size: 0.9em; }
        .results { margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; max-height: 500px; overflow-y: auto; }
        .results h3 { margin-bottom: 10px; color: #333; }
        .result-item { padding: 12px; background: white; margin-bottom: 10px; border-radius: 5px; border-left: 4px solid #667eea; }
        .level-card { padding: 15px; background: white; margin-bottom: 12px; border-radius: 8px; border-left: 4px solid #667eea; transition: transform 0.2s; cursor: pointer; }
        .level-card:hover { transform: translateX(5px); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .level-card-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px; }
        .level-name { font-size: 1.1em; font-weight: 600; color: #333; }
        .level-id { font-size: 0.8em; color: #999; cursor: pointer; }
        .level-id:hover { color: #667eea; }
        .level-creator { color: #666; font-size: 0.9em; margin-bottom: 8px; }
        .level-stats { display: flex; gap: 15px; flex-wrap: wrap; font-size: 0.9em; color: #555; }
        .pagination { display: flex; justify-content: center; gap: 10px; margin-top: 15px; }
        .pagination button { width: auto; padding: 8px 16px; font-size: 0.9em; }
        .page-info { display: flex; align-items: center; color: #666; font-weight: 500; }
        .loading { text-align: center; padding: 20px; color: #667eea; }
        .spinner { border: 3px solid #f3f3f3; border-top: 3px solid #667eea; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .error { color: #e74c3c; padding: 10px; background: #fadbd8; border-radius: 5px; margin-top: 10px; }
        .stats-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .stats-table th, .stats-table td { padding: 10px; text-align: left; border-bottom: 1px solid #e0e0e0; }
        .stats-table th { background: #f8f9fa; font-weight: 600; color: #555; }
        .stats-table tr:hover { background: #f8f9fa; }
        .rank { font-weight: bold; color: #667eea; }
        .rank-1 { color: #FFD700; }
        .rank-2 { color: #C0C0C0; }
        .rank-3 { color: #CD7F32; }
        .trophy-count { color: #f39c12; font-weight: 600; }
        .badge { display: inline-block; padding: 3px 8px; border-radius: 12px; font-size: 0.8em; font-weight: 600; }
        .badge-champion { background: #FFD700; color: #333; }
        .badge-diamond { background: #B9F2FF; color: #333; }
        .badge-gold { background: #FFD700; color: #333; }
        .comparison-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 10px; }
        .comparison-stat { background: white; padding: 10px; border-radius: 5px; text-align: center; }
        .comparison-stat-label { font-size: 0.8em; color: #666; margin-bottom: 5px; }
        .comparison-stat-value { font-size: 1.2em; font-weight: 600; color: #333; }
        .copy-btn { cursor: pointer; color: #667eea; font-size: 0.8em; margin-left: 5px; }
        .copy-btn:hover { text-decoration: underline; }
        footer { text-align: center; color: white; margin-top: 40px; padding: 20px; opacity: 0.8; }
        .github-link { color: white; text-decoration: none; font-weight: 600; }
        .github-link:hover { text-decoration: underline; }
        .filter-tabs { display: flex; gap: 10px; margin-bottom: 15px; }
        .filter-tab { flex: 1; padding: 10px; background: #f0f0f0; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s; }
        .filter-tab.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .quick-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 15px; }
        .quick-stat { background: white; padding: 15px; border-radius: 8px; text-align: center; }
        .quick-stat-value { font-size: 1.8em; font-weight: bold; color: #667eea; }
        .quick-stat-label { font-size: 0.9em; color: #666; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéØ Narrow Arrow Stats Hub</h1>
            <p class="subtitle">Comprehensive statistics and tools for Narrow Arrow players</p>
        </header>

        <div class="tools-grid">
            <div class="tool-card">
                <div class="tool-header"><span class="tool-icon">üë§</span><h2 class="tool-title">Player Lookup</h2></div>
                <p class="tool-description">Search for any player and view their complete stats, trophies, and achievements.</p>
                <div class="input-group"><label for="playerSearch">Player Username</label><input type="text" id="playerSearch" placeholder="Enter username..."></div>
                <button onclick="lookupPlayer()">Search Player</button>
                <div id="playerResults" class="results" style="display:none;"></div>
            </div>

            <div class="tool-card">
                <div class="tool-header"><span class="tool-icon">üèÜ</span><h2 class="tool-title">Live Leaderboard</h2></div>
                <p class="tool-description">View the current trophy leaderboard rankings in real-time.</p>
                <div class="input-group"><label>Show Top:</label><select id="leaderboardLimit"><option value="10">Top 10</option><option value="25">Top 25</option><option value="50" selected>Top 50</option><option value="100">Top 100</option></select></div>
                <button onclick="loadLeaderboard()">Load Leaderboard</button>
                <div id="leaderboardResults" class="results" style="display:none;"></div>
            </div>

            <div class="tool-card">
                <div class="tool-header"><span class="tool-icon">üìä</span><h2 class="tool-title">Level Statistics</h2></div>
                <p class="tool-description">Get detailed stats for any custom level including world records and play counts.</p>
                <div class="input-group"><label for="levelId">Level ID</label><input type="text" id="levelId" placeholder="1748711599490"></div>
                <div class="button-group"><button onclick="getLevelStats()">Get Stats</button><button onclick="getLevelLeaderboard()">View Leaderboard</button></div>
                <div id="levelResults" class="results" style="display:none;"></div>
            </div>

            <div class="tool-card">
                <div class="tool-header"><span class="tool-icon">üî•</span><h2 class="tool-title">Browse Levels</h2></div>
                <p class="tool-description">Discover the most popular and newest community levels.</p>
                <div class="filter-tabs"><button class="filter-tab active" onclick="setLevelFilter('popular')">üî• Popular</button><button class="filter-tab" onclick="setLevelFilter('new')">‚ú® New</button></div>
                <button onclick="getPopularLevels(0)">Browse Levels</button>
                <div id="popularResults" class="results" style="display:none;"></div>
            </div>

            <div class="tool-card">
                <div class="tool-header"><span class="tool-icon">‚ö°</span><h2 class="tool-title">World Records</h2></div>
                <p class="tool-description">View world record holders for official levels.</p>
                <div class="input-group"><label for="officialLevel">Level Name</label><select id="officialLevel"><option value="Chain Reaction">Chain Reaction</option><option value="Arrow Factory">Arrow Factory</option><option value="Speedrun Highway">Speedrun Highway</option><option value="Attractive Curves">Attractive Curves</option></select></div>
                <button onclick="getWorldRecord()">View Records</button>
                <div id="wrResults" class="results" style="display:none;"></div>
            </div>

            <div class="tool-card">
                <div class="tool-header"><span class="tool-icon">üéÆ</span><h2 class="tool-title">Run Analyzer</h2></div>
                <p class="tool-description">Analyze any run by its ID to see detailed replay information.</p>
                <div class="input-group"><label for="runId">Run ID</label><input type="number" id="runId" placeholder="1844705"></div>
                <button onclick="analyzeRun()">Analyze Run</button>
                <div id="runResults" class="results" style="display:none;"></div>
            </div>

            <div class="tool-card">
                <div class="tool-header"><span class="tool-icon">‚öñÔ∏è</span><h2 class="tool-title">Player Comparison</h2></div>
                <p class="tool-description">Compare two players side by side.</p>
                <div class="input-group"><label for="player1">Player 1</label><input type="text" id="player1" placeholder="Username 1"></div>
                <div class="input-group"><label for="player2">Player 2</label><input type="text" id="player2" placeholder="Username 2"></div>
                <button onclick="comparePlayers()">Compare</button>
                <div id="compareResults" class="results" style="display:none;"></div>
            </div>

            <div class="tool-card">
                <div class="tool-header"><span class="tool-icon">üîç</span><h2 class="tool-title">Level Search</h2></div>
                <p class="tool-description">Search for levels by creator name.</p>
                <div class="input-group"><label for="creatorSearch">Creator Name</label><input type="text" id="creatorSearch" placeholder="e.g., sqm, Ripted"></div>
                <button onclick="searchByCreator()">Search Levels</button>
                <div id="searchResults" class="results" style="display:none;"></div>
            </div>
        </div>

        <footer>
            <p>Made with ‚ù§Ô∏è for the Narrow Arrow community</p>
            <p><a href="https://github.com" class="github-link">View on GitHub</a></p>
            <p style="margin-top: 10px; font-size: 0.9em;">Using worker: narrow-hub.wilmer-v-123321.workers.dev</p>
        </footer>
    </div>

    <script>
        const API_BASE = 'https://api.narrowarrow.xyz';
        const PROXY = 'https://narrow-hub.wilmer-v-123321.workers.dev/?url=';
        let currentFilter = 'popular';

        function getURL(e) { return PROXY + encodeURIComponent(API_BASE + e); }
        function copyToClipboard(t) { navigator.clipboard.writeText(t); alert('Copied!'); }
        function setLevelFilter(f) { currentFilter = f; document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active')); event.target.classList.add('active'); }

        async function lookupPlayer() {
            const username = document.getElementById('playerSearch').value.trim();
            const resultsDiv = document.getElementById('playerResults');
            if (!username) { alert('Please enter a username'); return; }
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>Loading...</div>';
            try {
                const response = await fetch(getURL(`/user/${username}`));
                if (!response.ok) throw new Error('Player not found');
                const data = await response.json();
                const badge = data.league.includes('Champion') ? 'champion' : data.league.includes('Diamond') ? 'diamond' : 'gold';
                resultsDiv.innerHTML = `<h3>üë§ ${data.user.username}</h3><div class="quick-stats"><div class="quick-stat"><div class="quick-stat-value">${data.trophies}</div><div class="quick-stat-label">üèÜ Trophies</div></div><div class="quick-stat"><div class="quick-stat-value">${data.win_streak}</div><div class="quick-stat-label">üî• Win Streak</div></div><div class="quick-stat"><div class="quick-stat-value">${data.total_runs}</div><div class="quick-stat-label">üéÆ Runs</div></div></div><div class="result-item"><strong>League:</strong> <span class="badge badge-${badge}">${data.league}</span></div><div class="result-item"><strong>Bio:</strong> ${data.user.bio || 'No bio'}</div><div class="result-item"><strong>Joined:</strong> ${new Date(data.user.joined).toLocaleDateString()}</div><div class="result-item"><strong>Max Streak:</strong> ${data.max_win_streak}</div><div class="result-item"><strong>Maps:</strong> ${data.maps_completed}</div><div class="result-item"><strong>Custom Levels:</strong> ${data.custom_levels_completed}</div>`;
            } catch (error) { resultsDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`; }
        }

        async function loadLeaderboard() {
            const limit = document.getElementById('leaderboardLimit').value;
            const resultsDiv = document.getElementById('leaderboardResults');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>Loading...</div>';
            try {
                const response = await fetch(getURL('/leaderboard/trophies'));
                const data = await response.json();
                let html = '<h3>üèÜ Top Players</h3><table class="stats-table"><thead><tr><th>Rank</th><th>Player</th><th>Trophies</th><th>League</th><th>Streak</th></tr></thead><tbody>';
                data.slice(0, parseInt(limit)).forEach((player, index) => {
                    const rankClass = index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : index === 2 ? 'rank-3' : 'rank';
                    const badge = player.league.includes('Champion') ? 'champion' : player.league.includes('Diamond') ? 'diamond' : 'gold';
                    html += `<tr><td class="${rankClass}">#${index + 1}</td><td>${player.username}</td><td class="trophy-count">${player.trophies}</td><td><span class="badge badge-${badge}">${player.league}</span></td><td>${player.win_streak > 0 ? 'üî• ' + player.win_streak : player.win_streak}</td></tr>`;
                });
                html += '</tbody></table>';
                resultsDiv.innerHTML = html;
            } catch (error) { resultsDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`; }
        }

        async function getLevelStats() {
            const levelId = document.getElementById('levelId').value.trim();
            const resultsDiv = document.getElementById('levelResults');
            if (!levelId) { alert('Please enter a level ID'); return; }
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>Loading...</div>';
            try {
                const response = await fetch(getURL(`/level-details/${levelId}?isCustomLevel=true`));
                if (!response.ok) throw new Error('Level not found');
                const data = await response.json();
                const info = data.levelInfo;
                const wr = data.worldRecord;
                resultsDiv.innerHTML = `<h3>üìä ${info.name}</h3><div class="quick-stats"><div class="quick-stat"><div class="quick-stat-value">${info.like_count}</div><div class="quick-stat-label">‚ù§Ô∏è Likes</div></div><div class="quick-stat"><div class="quick-stat-value">${data.runCount}</div><div class="quick-stat-label">üéÆ Runs</div></div>${wr ? `<div class="quick-stat"><div class="quick-stat-value">${wr.completion_time}s</div><div class="quick-stat-label">üèÜ WR</div></div>` : ''}</div><div class="result-item"><strong>Creator:</strong> ${info.author}</div><div class="result-item"><strong>Level ID:</strong> ${info.level_id} <span class="copy-btn" onclick="copyToClipboard('${info.level_id}')">[Copy]</span></div><div class="result-item"><strong>Created:</strong> ${new Date(info.created_at).toLocaleDateString()}</div>${wr ? `<div class="result-item"><strong>üèÜ WR:</strong> ${wr.completion_time}s by ${wr.username} (${wr.arrow_name})<br><small>${new Date(wr.created_at).toLocaleDateString()}</small></div>` : ''}${data.personalBest ? `<div class="result-item"><strong>Your PB:</strong> ${data.personalBest.completion_time}s (${data.personalBest.arrow_name})</div>` : ''}`;
            } catch (error) { resultsDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`; }
        }

        async function getLevelLeaderboard() {
            const levelId = document.getElementById('levelId').value.trim();
            const resultsDiv = document.getElementById('levelResults');
            if (!levelId) { alert('Please enter a level ID'); return; }
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>Loading...</div>';
            try {
                const response = await fetch(getURL(`/leaderboard?levelId=${levelId}`));
                if (!response.ok) throw new Error('Not found');
                const data = await response.json();
                let html = '<h3>üèÜ Leaderboard</h3><table class="stats-table"><thead><tr><th>Rank</th><th>Player</th><th>Time</th><th>Arrow</th><th>Date</th></tr></thead><tbody>';
                data.slice(0, 20).forEach((run, index) => {
                    const rankClass = index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : index === 2 ? 'rank-3' : 'rank';
                    html += `<tr><td class="${rankClass}">#${index + 1}</td><td>${run.username}</td><td><strong>${run.completion_time}s</strong></td><td>${run.arrow_name}</td><td><small>${new Date(run.created_at).toLocaleDateString()}</small></td></tr>`;
                });
                html += '</tbody></table>';
                resultsDiv.innerHTML = html;
            } catch (error) { resultsDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`; }
        }

        async function getPopularLevels(page) {
            const resultsDiv = document.getElementById('popularResults');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>Loading...</div>';
            try {
                const response = await fetch(getURL(`/published-levels?filter=${currentFilter}&page=${page}`));
                const levels = await response.json();
                let html = `<h3>${currentFilter === 'popular' ? 'üî• Most Popular' : '‚ú® Newest'} Levels</h3>`;
                levels.forEach(level => {
                    html += `<div class="level-card" onclick="document.getElementById('levelId').value='${level.level_id}'; getLevelStats();"><div class="level-card-header"><div class="level-name">${level.name}</div><div class="level-id" onclick="event.stopPropagation(); copyToClipboard('${level.level_id}');" title="Copy ID">üìã</div></div><div class="level-creator">by ${level.creator_name}</div><div class="level-stats"><span>‚ù§Ô∏è ${level.like_count}</span><span>üéÆ ${level.play_count}</span><span>üèÜ ${level.world_record.completion_time}s by ${level.world_record.username}</span></div></div>`;
                });
                html += `<div class="pagination">${page > 0 ? `<button onclick="getPopularLevels(${page - 1})">‚óÄ Previous</button>` : ''}<span class="page-info">Page ${page + 1}</span><button onclick="getPopularLevels(${page + 1})">Next ‚ñ∂</button></div>`;
                resultsDiv.innerHTML = html;
            } catch (error) { resultsDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`; }
        }

        async function getWorldRecord() {
            const levelName = document.getElementById('officialLevel').value;
            const resultsDiv = document.getElementById('wrResults');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>Loading...</div>';
            try {
                const response = await fetch(getURL(`/leaderboard/Official%20Level?name=${encodeURIComponent(levelName)}`));
                const records = await response.json();
                let html = `<h3>üèÜ ${levelName}</h3>`;
                records.slice(0, 10).forEach((record, index) => {
                    html += `<div class="result-item"><span class="rank">#${index + 1}</span> <strong>${record.username}</strong> - ${record.completion_time}s<br><small>${record.arrow_name} | ${new Date(record.created_at).toLocaleDateString()}</small></div>`;
                });
                resultsDiv.innerHTML = html;
            } catch (error) { resultsDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`; }
        }

        async function analyzeRun() {
            const runId = document.getElementById('runId').value.trim();
            const resultsDiv = document.getElementById('runResults');
            if (!runId) { alert('Please enter a run ID'); return; }
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>Loading...</div>';
            try {
                const response = await fetch(getURL(`/runs/${runId}`));
                if (!response.ok) throw new Error('Run not found');
                const data = await response.json();
                resultsDiv.innerHTML = `<h3>üéÆ Run #${data.runId}</h3><div class="result-item"><strong>Level:</strong> ${data.mapName}</div><div class="result-item"><strong>Arrow:</strong> ${data.arrow_name}</div><div class="result-item"><strong>Time:</strong> ${data.completion_time}s</div><div class="result-item"><strong>Inputs:</strong> ${data.input_count}</div><div class="result-item"><strong>Verified:</strong> ${data.verified ? '‚úÖ Yes' : '‚ùå No'}</div><div class="result-item"><strong>Date:</strong> ${new Date(data.finishedAt).toLocaleString()}</div><div class="result-item"><strong>Theme:</strong> ${data.skinConfig.themeColor.name}<br><strong>Thrust:</strong> ${data.skinConfig.thrustColor.name}<br><strong>Shader:</strong> ${data.skinConfig.thrustShader.name}</div>`;
            } catch (error) { resultsDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`; }
        }

        async function comparePlayers() {
            const p1 = document.getElementById('player1').value.trim();
            const p2 = document.getElementById('player2').value.trim();
            const resultsDiv = document.getElementById('compareResults');
            if (!p1 || !p2) { alert('Enter both usernames'); return; }
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>Loading...</div>';
            try {
                const [r1, r2] = await Promise.all([fetch(getURL(`/user/${p1}`)), fetch(getURL(`/user/${p2}`))]);
                const [d1, d2] = await Promise.all([r1.json(), r2.json()]);
                resultsDiv.innerHTML = `<h3>‚öñÔ∏è ${d1.user.username} vs ${d2.user.username}</h3><div class="comparison-grid"><div class="comparison-stat"><div class="comparison-stat-label">üèÜ Trophies</div><div class="comparison-stat-value">${d1.trophies} vs ${d2.trophies}</div></div><div class="comparison-stat"><div class="comparison-stat-label">üî• Win Streak</div><div class="comparison-stat-value">${d1.win_streak} vs ${d2.win_streak}</div></div><div class="comparison-stat"><div class="comparison-stat-label">üéÆ Total Runs</div><div class="comparison-stat-value">${d1.total_runs} vs ${d2.total_runs}</div></div><div class="comparison-stat"><div class="comparison-stat-label">üó∫Ô∏è Maps</div><div class="comparison-stat-value">${d1.maps_completed} vs ${d2.maps_completed}</div></div></div>`;
            } catch (error) { resultsDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`; }
        }

        async function searchByCreator() {
            const creator = document.getElementById('creatorSearch').value.trim();
            const resultsDiv = document.getElementById('searchResults');
            if (!creator) { alert('Enter creator name'); return; }
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>Searching...</div>';
            try {
                const response = await fetch(getURL('/published-levels?filter=popular&page=0'));
                const levels = await response.json();
                const filtered = levels.filter(l => l.creator_name.toLowerCase().includes(creator.toLowerCase()));
                if (filtered.length === 0) { resultsDiv.innerHTML = `<div class="error">No levels found by "${creator}"</div>`; return; }
                let html = `<h3>üîç Levels by ${creator} (${filtered.length} found)</h3>`;
                filtered.forEach(level => {
                    html += `<div class="level-card" onclick="document.getElementById('levelId').value='${level.level_id}'; getLevelStats();"><div class="level-card-header"><div class="level-name">${level.name}</div><div class="level-id" onclick="event.stopPropagation(); copyToClipboard('${level.level_id}');">üìã</div></div><div class="level-creator">by ${level.creator_name}</div><div class="level-stats"><span>‚ù§Ô∏è ${level.like_count}</span><span>üéÆ ${level.play_count}</span><span>üèÜ ${level.world_record.completion_time}s</span></div></div>`;
                });
                resultsDiv.innerHTML = html;
            } catch (error) { resultsDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`; }
        }

        document.getElementById('playerSearch').addEventListener('keypress', (e) => { if (e.key === 'Enter') lookupPlayer(); });
        document.getElementById('levelId').addEventListener('keypress', (e) => { if (e.key === 'Enter') getLevelStats(); });
        document.getElementById('runId').addEventListener('keypress', (e) => { if (e.key === 'Enter') analyzeRun(); });
        document.getElementById('player1').addEventListener('keypress', (e) => { if (e.key === 'Enter') comparePlayers(); });
        document.getElementById('player2').addEventListener('keypress', (e) => { if (e.key === 'Enter') comparePlayers(); });
        document.getElementById('creatorSearch').addEventListener('keypress', (e) => { if (e.key === 'Enter') searchByCreator(); });
    </script>
</body>
</html>
